# ==========================
# üêπ Dockerfile cho Go WebSocket Chat Server
# ==========================

# S·ª≠ d·ª•ng Go image ch√≠nh th·ª©c
FROM golang:1.22-alpine AS builder

# T·∫°o th∆∞ m·ª•c l√†m vi·ªác trong container
WORKDIR /app

# Copy file go.mod v√† go.sum tr∆∞·ªõc ƒë·ªÉ c√†i dependency
COPY go.mod go.sum ./
RUN go mod download

# Copy to√†n b·ªô m√£ ngu·ªìn v√†o container
COPY . .

# Build binary (t√™n file: main)
RUN go build -o main .

# ==========================
# Stage 2: Ch·∫°y server
# ==========================
FROM alpine:latest

# T·∫°o th∆∞ m·ª•c /app v√† copy binary t·ª´ stage tr∆∞·ªõc
WORKDIR /app
COPY --from=builder /app/main .

# C·ªïng server Go ch·∫°y (8080)
EXPOSE 8080

# Ch·∫°y server
CMD ["./main"]
